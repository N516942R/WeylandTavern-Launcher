# WeylandTavern Launcher – Agent Overview

## Purpose and high-level flow
- This repository ships a desktop launcher that wraps SillyTavern inside a Tauri shell. The React UI in `Launcher/src` drives the onboarding prompts while the Rust backend in `Launcher/src-tauri/src/main.rs` performs git updates, dependency installs, and the final Node server spawn that serves the bundled SillyTavern instance.
- Application configuration lives alongside the launcher (`Launcher/.env`), defining vendor paths, server host/port flags, npm install policy, and whether the optional character sync runs before startup.
- Manual update tooling is provided both from the UI (via `update_vendor` in the Rust backend) and from a PowerShell helper script in `tools` for pinning the `vendor/WeylandTavern` submodule to a specific ref.

## Directory map (90–95% coverage)
| Path | Highlights | Notes |
| --- | --- | --- |
| `.` | Repo metadata such as `.gitignore`, `.gitmodules`, and the custom `.pre-commit-config.yaml`. | The pre-commit hook forbids committing a different `vendor/WeylandTavern` HEAD directly, protecting the submodule pointer.
| `Launcher/` | Frontend project root with Vite config (`vite.config.ts`), TypeScript settings (`tsconfig.json`), entry HTML (`index.html`), npm manifest, and runtime `.env`. | Contains both the React UI (`src/`) and the Rust Tauri project (`src-tauri/`). Logs land in `logs/` (tracked via `.gitkeep`) and dependencies in the ignored `node_modules/` folder.
| `Launcher/src/` | React SPA entry point (`main.tsx`) and stateful UI (`App.tsx`). | The UI listens for backend events, renders the update/character flow, and swaps to an `<iframe>` once SillyTavern is live.
| `Launcher/src-tauri/` | Rust-side Tauri app with Cargo manifests, build script, config JSON, and icons. | `Cargo.lock` pins dependencies, `tauri.conf.json` configures the window/CSP, and `build.rs` delegates to `tauri_build`.
| `Launcher/src-tauri/src/` | Core backend logic in `main.rs`. | Hosts the async commands invoked from the UI plus the process supervision and log piping.
| `Launcher/src-tauri/icons/` | Application icon assets. | Included in bundle metadata.
| `Launcher/logs/` | Runtime server log output directory. | Empty in source control except for `.gitkeep`.
| `Launcher/node_modules/` | Frontend dependencies. | Ignored; generated by npm install.
| `tools/` | Automation scripts like `Update-WeylandTavern.ps1`. | Used by the `.env` `UPDATE_SCRIPT` reference and the Windows batch wrapper at repo root.
| `vendor/` | Container directory for the SillyTavern submodule. | See below for usage guidelines.
| `vendor/WeylandTavern` | Git submodule pointing at https://github.com/Shirubaurufu/WeylandTavern (nightly branch, shallow). | Managed via git submodule commands; do not modify contents directly in commits.
| `Update-Weyland.bat` | Windows helper to run the PowerShell updater with defaults. | Invokes the PowerShell script with `origin/nightly` and `-PinExact`.

## Build & run workflow snapshot
1. Install prerequisites (Node + npm, Rust toolchain) and populate `.env` if the defaults in `Launcher/.env` need adjusting.
2. Use `npm install` / `npm run tauri dev` from the `Launcher` directory; scripts are defined in `Launcher/package.json` and `tauri.conf.json` expects the UI dev server at `http://localhost:5173`.
3. During runtime the frontend requests `start_server` from the backend, which ensures npm dependencies via `should_npm_install`, spawns `node server.js` with the configured host/port, and streams logs into `Launcher/logs/server-<date>.log`.

## Update & synchronization flow
- UI update step: `App.tsx` exposes handlers that call the backend commands (`update_vendor`, `finalize_stash`, `run_character_sync`, and `start_server`) and shows retry/skip prompts. It also binds Ctrl+L/Ctrl+R/Ctrl+Q shortcuts and toggles the live log overlay.
- Backend coordination: `main.rs` loads `.env`, verifies the SillyTavern directory, runs `git pull` against the vendor repo, optionally stashes/pops, writes `WTUpdate.log`, and surfaces diff summaries to the UI. It also runs the optional `character-downloader.js` via Node when requested.
- Manual pinning: `tools/Update-WeylandTavern.ps1` bootstraps the submodule, fetches the requested ref (branch/tag/SHA), checks it out (with optional detached mode), and commits the submodule pointer if it changed.

## Housekeeping & guardrails
- `.pre-commit-config.yaml` adds a hook to block submodule HEAD drift in staged changes.
- `.gitignore` keeps generated artefacts like `Launcher/logs/`, `Launcher/dist/`, and `Launcher/src-tauri/target/` out of commits.
- Respect the submodule boundary—never commit inside `vendor/WeylandTavern`; rely on the update script or UI flow to move it.

## Navigation helpers
- See `agent_nav.json` for a machine-readable list of the top 20 golden artefacts (entry points, configs, scripts, and submodule pointers) plus curated quick-link buckets for frontend, backend, config, and automation tasks.
